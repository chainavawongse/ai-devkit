---
name: setting-up-pre-commit
description: Configure pre-commit hooks for automated quality checks and conventional commit validation. Detects project tooling and suggests appropriate hooks (Python: ruff/mypy, TypeScript: ESLint/Prettier, etc.), respects existing configuration, and integrates with justfile.
when_to_use: when setting up pre-commit hooks for a repository, adding hooks to existing configuration, configuring quality checks for CI/CD, or standardizing commit conventions
version: 1.0.0
---

# Setting Up Pre-commit Hooks

Configure pre-commit hooks for automated quality checks, code formatting, and conventional commit validation.

**Core principle:** Minimal by default, expand on request. Respect existing configuration and only add what the project needs based on detected tooling.

**Purpose:** This skill sets up pre-commit hooks that automatically run quality checks before commits, ensuring code quality and consistency. It detects project-specific tooling and suggests relevant hooks without over-engineering.

## Overview

This skill guides you through:

1. Checking for existing pre-commit configuration
2. Detecting project tooling (languages, linters, formatters)
3. Creating minimal .pre-commit-config.yaml with essential hooks
4. Offering language-specific and additional hooks based on detection
5. Installing pre-commit and activating hooks
6. Running initial formatting pass
7. Adding pre-commit recipes to justfile

## When to Use

**Use this skill when:**

- Setting up pre-commit hooks for the first time
- Adding new hooks to existing configuration
- Standardizing commit conventions (conventional commits)
- Configuring automated quality checks
- Integrating quality checks into development workflow

**Don't use when:**

- Project explicitly doesn't want pre-commit hooks
- Running in CI/CD only (not local development)
- Hooks would conflict with existing tooling

## Workflow

### 1. Check Existing Configuration

**Check for existing .pre-commit-config.yaml:**

```bash
test -f .pre-commit-config.yaml
```

**If exists:**

- Read the existing configuration
- Show current hooks to user
- Ask: "Keep as-is / Add new hooks / Replace completely"
- If "Keep as-is": Exit gracefully
- If "Add new hooks": Proceed with detection and append only new hooks
- If "Replace completely": Backup existing file

```bash
# Backup existing config
cp .pre-commit-config.yaml .pre-commit-config.yaml.backup.$(date +%Y%m%d-%H%M%S)
```

### 2. Detect Project Tooling

Use TodoWrite to track detection tasks:

- [ ] Detect primary language(s)
- [ ] Detect package managers
- [ ] Detect linters and formatters
- [ ] Detect testing frameworks
- [ ] Detect infrastructure as code (Docker, Terraform)
- [ ] Check for existing style configs (.eslintrc, ruff.toml, etc.)

**Detection commands:**

```bash
# Detect languages
find . -maxdepth 3 -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.go" -o -name "*.rs" | head -5

# Detect Python tooling
ls pyproject.toml requirements.txt setup.py 2>/dev/null
grep -E "ruff|black|mypy|flake8" pyproject.toml 2>/dev/null

# Detect TypeScript/JavaScript tooling
ls package.json tsconfig.json .eslintrc* .prettierrc* 2>/dev/null
grep -E "eslint|prettier" package.json 2>/dev/null

# Detect Go tooling
ls go.mod go.sum 2>/dev/null

# Detect Rust tooling
ls Cargo.toml Cargo.lock 2>/dev/null

# Detect infrastructure
ls Dockerfile docker-compose.yml 2>/dev/null
find . -maxdepth 2 -name "*.tf" | head -1

# Detect shell scripts
find . -maxdepth 3 -name "*.sh" | head -5
```

### 3. Create Minimal Configuration

**Always include these essential hooks:**

1. **Conventional Commits validation** - Enforces commit message format
2. **General file checks** - Trailing whitespace, large files, merge conflicts, private keys

Use the base template from `templates/pre-commit-config.yaml`:

```yaml
# Pre-commit hooks configuration
default_install_hook_types:
  - pre-commit
  - commit-msg

repos:
  # Conventional Commits validation (RECOMMENDED)
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.6.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]

  # General file checks (RECOMMENDED)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-added-large-files
      - id: check-merge-conflict
      - id: detect-private-key
```

### 4. Suggest Language-Specific Hooks

Based on detected tooling, offer to add language-specific hooks.

**Python detected:**

Ask: "I detected Python. Would you like to add:

- ruff for linting and formatting?
- mypy for type checking?"

**If user accepts ruff:**

```yaml
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.4
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format
```

**If user accepts mypy:**

```yaml
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.14.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
```

**TypeScript/JavaScript detected:**

Ask: "I detected TypeScript/JavaScript. Would you like to add:

- ESLint for linting?
- Prettier for formatting?"

**If user accepts ESLint:**

```yaml
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v9.17.0
    hooks:
      - id: eslint
        files: \.(js|ts|jsx|tsx)$
        types: [file]
```

**If user accepts Prettier:**

```yaml
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        types_or: [css, javascript, jsx, ts, tsx, json, markdown, yaml]
```

**Go detected:**

Ask: "I detected Go. Would you like to add:

- golangci-lint for linting?
- go-fmt and go-vet for formatting and vetting?"

**Rust detected:**

Ask: "I detected Rust. Would you like to add:

- cargo fmt for formatting?
- clippy for linting?"

### 5. Suggest Additional Hooks

**Always offer these regardless of language:**

Ask: "Would you like to add any of these security/quality hooks:

- detect-secrets: Secret detection (recommended)
- trufflehog: Advanced secret scanning
- hadolint: Dockerfile linting (if Docker detected)
- terraform hooks: Terraform validation (if .tf files detected)
- shellcheck: Shell script linting (if .sh files detected)"

### 6. Write Configuration File

**If adding to existing file:**

- Append new hooks to existing .pre-commit-config.yaml
- Preserve existing formatting and structure
- Add comment indicating which hooks were added

**If creating new file:**

- Write complete .pre-commit-config.yaml with selected hooks
- Include commented-out suggestions for easy enabling later
- Add header comments with usage instructions

### 7. Install Pre-commit

**Check if pre-commit is installed:**

```bash
command -v pre-commit >/dev/null 2>&1
```

**If not installed:**

```bash
# Install pre-commit
pip install pre-commit

# Verify installation
pre-commit --version
```

**Install hooks:**

```bash
# Install hooks in .git/hooks/
pre-commit install --install-hooks

# Also install commit-msg hook for conventional commits
pre-commit install --hook-type commit-msg
```

### 8. Run Initial Pass

**Run pre-commit on all files:**

```bash
pre-commit run --all-files
```

**If hooks make changes:**

- Show what changed
- List modified files
- Ask user: "Pre-commit hooks made formatting changes. Would you like to:
  1. Review changes first
  2. Stage and commit all changes
  3. Stage changes but don't commit yet"

**Handle response:**

1. **Review first**: Show diff with `git diff`
2. **Stage and commit**:

   ```bash
   git add .
   git commit -m "chore: apply pre-commit formatting

   ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude <noreply@anthropic.com>"
   ```

3. **Stage only**: `git add .`

### 9. Add Justfile Recipes

**Check if justfile exists:**

```bash
test -f justfile
```

**If exists:**

- Ask: "Would you like to add pre-commit recipes to justfile?"
- If yes, append these recipes:

```justfile
# Install pre-commit hooks
pre-commit-install:
    pre-commit install --install-hooks
    pre-commit install --hook-type commit-msg

# Run pre-commit on all files
pre-commit-run:
    pre-commit run --all-files

# Update pre-commit hooks to latest versions
pre-commit-update:
    pre-commit autoupdate

# Run pre-commit on staged files only
pre-commit-staged:
    pre-commit run
```

**If doesn't exist:**

- Inform user that pre-commit recipes can be added manually or wait for justfile creation

### 10. Verification

**Verify setup is complete:**

1. **Check .pre-commit-config.yaml exists:**

   ```bash
   test -f .pre-commit-config.yaml && echo "‚úì Config file exists"
   ```

2. **Check hooks are installed:**

   ```bash
   test -f .git/hooks/pre-commit && echo "‚úì Pre-commit hook installed"
   test -f .git/hooks/commit-msg && echo "‚úì Commit-msg hook installed"
   ```

3. **Test hooks work:**

   ```bash
   # This should pass (or fail with formatting fixes)
   pre-commit run --all-files
   ```

4. **Check justfile recipes (if applicable):**

   ```bash
   just --list | grep pre-commit
   ```

## Expected Output

**Successful completion:**

- .pre-commit-config.yaml created or updated
- Pre-commit installed and hooks activated
- Initial formatting pass complete
- Justfile recipes added (if justfile exists)
- All changes staged (if user chose to stage)

**Summary to provide:**

```markdown
# Pre-commit Setup Complete

## Configuration
- ‚úÖ .pre-commit-config.yaml created/updated
- ‚úÖ Hooks installed in .git/hooks/

## Enabled Hooks
### Required
- ‚úÖ Conventional commits validation
- ‚úÖ General file checks (whitespace, large files, etc.)

### Language-Specific
- [‚úÖ/‚ùå] Python: ruff, mypy
- [‚úÖ/‚ùå] TypeScript/JavaScript: ESLint, Prettier
- [‚úÖ/‚ùå] Go: golangci-lint, go-fmt
- [‚úÖ/‚ùå] Rust: cargo fmt, clippy

### Additional
- [‚úÖ/‚ùå] Secret detection (detect-secrets)
- [‚úÖ/‚ùå] Docker linting (hadolint)
- [‚úÖ/‚ùå] Terraform validation
- [‚úÖ/‚ùå] Shell script linting (shellcheck)

## Next Steps
1. Test hooks: Make a commit to see hooks in action
2. Run manually: `just pre-commit-run` or `pre-commit run --all-files`
3. Update hooks: `just pre-commit-update` or `pre-commit autoupdate`
4. Customize: Edit .pre-commit-config.yaml to adjust hook settings

## Usage
- **Automatic**: Hooks run on every commit
- **Manual**: `pre-commit run --all-files`
- **Skip (emergency)**: `git commit --no-verify` (not recommended)
```

## Error Handling

**Pre-commit installation fails:**

- Check if pip is available
- Try alternative: `brew install pre-commit` (macOS) or `apt-get install pre-commit` (Linux)
- Provide manual installation instructions
- Offer to continue without installing (user can install later)

**Hook execution fails:**

- Show error message from hook
- Explain what the hook does and why it failed
- Offer to:
  1. Fix the issue
  2. Skip this hook (comment it out)
  3. Continue anyway (not recommended)

**Conflicts with existing configuration:**

- Show existing hooks vs. proposed hooks
- Ask user which to keep
- Merge configurations carefully
- Preserve user's existing settings

**Formatting changes break tests:**

- Warn user before running initial pass
- Offer to run on subset of files first
- Allow user to review changes before committing
- Provide rollback option if needed

## Notes

**Templates location:** All templates are nested under this skill directory at `plugins/skills/setting-up-pre-commit/templates/`

- `templates/pre-commit-config.yaml` - Base configuration with all hooks (commented)
- `templates/pre-commit-suggestions.md` - Detailed explanations of suggested hooks

**Integration with other skills:**

- **After writing-justfiles:** Add pre-commit recipes to newly created justfiles
- **Before code-reviewer:** Ensure pre-commit runs to catch issues early
- **During setup command:** Called from Phase 4 of repository setup

**Best practices:**

- Start minimal, expand based on need
- Respect existing project conventions
- Don't force hooks user doesn't want
- Make it easy to disable/customize hooks
- Provide clear documentation on usage
